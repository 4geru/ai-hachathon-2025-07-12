# Sky Canvas - 技術スタック: Supabase

## 1. 概要

Supabaseは、オープンソースのバックエンドサービスを提供するプラットフォームです。PostgreSQLデータベースをベースに、リアルタイム機能、認証、ストレージ、Edge Functionsなど、Webアプリケーションに必要な様々な機能を提供します。本プロジェクト「Sky Canvas」では、スマートフォンアプリとディスプレイアプリ間のリアルタイムデータ連携の基盤として利用されます。

## 2. 採用理由

-   **リアルタイム機能:** Supabase Realtimeは、データベースの変更（INSERT, UPDATE, DELETE）をWebSocketを通じてリアルタイムにクライアントに通知する機能を提供します。これにより、スマートフォンからの操作をディスプレイに瞬時に反映させることが可能です。
-   **PostgreSQLベース:** 堅牢で柔軟なリレーショナルデータベースとしてPostgreSQLを採用しており、データの整合性と拡張性を確保できます。
-   **開発の迅速性:** バックエンドの構築と管理を大幅に簡素化できるため、ハッカソンという限られた時間の中で迅速な開発が可能です。
-   **オープンソース:** 透明性が高く、コミュニティによるサポートや情報が豊富です。
-   **APIの自動生成:** データベーススキーマに基づいてRESTful APIが自動生成されるため、クライアントからのデータアクセスが容易です。

## 3. プロジェクトにおける役割

### 3.1. リアルタイムデータベース

-   **`firework_events` テーブル:** スマートフォンアプリからの花火発射イベントデータを保存します。傾きデータ、ジェスチャーデータ、ユーザーID、デバイスタイプ、そして花火の「Vibe」パラメータ（色、サイズ、パターン、AIシードなど）がこのテーブルに記録されます。
-   **リアルタイム通知:** `firework_events` テーブルへの`INSERT`イベントをディスプレイアプリにリアルタイムで通知します。これがスマホとディスプレイ間のラグのない同期を実現する鍵となります。

### 3.2. API

-   **RESTful API:** SupabaseクライアントSDKを通じて、データベースへのデータの読み書きを可能にします。
-   **Supabase Client SDK:** JavaScript/TypeScriptクライアントからSupabaseの各機能にアクセスするためのライブラリです。スマートフォンアプリとディスプレイアプリの両方で使用されます。

## 4. 関連する設計判断

-   **認証・認可:** 匿名ユーザーとしてSupabaseに接続し、セッションごとにUUIDを生成して`user_id`として利用します。セキュリティのため、Row Level Security (RLS) を適切に設定し、`firework_events`テーブルへの`INSERT`権限を匿名ユーザーに与え、`SELECT`権限はディスプレイアプリに限定するか、適切に公開範囲を調整します。
-   **データモデル:** リアルタイムパフォーマンスを最大化するため、`firework_events`テーブルはシンプルに保ち、必要な情報のみをJSONB形式で格納します。
-   **共通モジュール:** `@skycanvas/supabase-client`という共有パッケージを作成し、Supabaseクライアントの初期化やリアルタイム購読の共通処理、データ送信ヘルパー関数などを一元的に管理します。 
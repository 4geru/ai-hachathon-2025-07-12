# Sky Canvas - 技術スタック: DeviceOrientation API

## 1. 概要

DeviceOrientation APIは、スマートフォンの物理的な向き（デバイスの空間における向き）の変化を検出するためのWeb APIです。本プロジェクト「Sky Canvas」では、スマートフォンを「魔法の杖」として使用し、その傾きや動きを花火の発射トリガーとするために利用されます。

## 2. 採用理由

-   **直感的な操作性:** ユーザーがスマートフォンを傾けるという自然な動作で花火を操作できるため、高い没入感と遊び心を提供できます。
-   **Web標準API:** ブラウザに組み込まれている標準APIであるため、追加のライブラリやプラグインなしで利用可能です。
-   **リアルタイムデータ:** デバイスの向きの変化をリアルタイムで取得できるため、操作と花火の表示間の低遅延を実現できます。

## 3. プロジェクトにおける役割

### 3.1. スマートフォンアプリ

-   **傾きデータ取得:** スマートフォンの加速度センサーとジャイロセンサーから、デバイスの傾き（alpha, beta, gamma軸の回転角）を継続的に取得します。
-   **ジェスチャー検知の基盤:** 傾きデータの変化速度やパターンを解析し、「フリック」や「スイング」といった特定のジェスチャーを検知するための入力データとして使用します。
-   **花火発射トリガー:** 定義された傾きやジェスチャーの閾値を超えた場合に、花火発射イベントをSupabaseに送信するためのトリガーとして機能します。

## 4. 関連する設計判断

-   **データフィルタリング:** センサーデータのノイズを軽減し、安定した値を得るために、移動平均フィルタやカルマンフィルタなどのソフトウェアフィルタリングを適用します。
-   **更新頻度の最適化:** バッテリー消費とリアルタイム性のバランスを考慮し、センサーデータの取得頻度を調整します（例: 通常時60Hz、発射検知時200Hz）。
-   **Webブラウザの許可要求:** iOS 13以降のSafariなど、一部のブラウザではDeviceOrientation APIの使用にユーザーの明示的な許可が必要です。これに対応するためのUI/UXを設計します。
-   **データ変換とVibe生成:** 取得した傾きデータやジェスチャーデータを、花火の「Vibe」パラメータ（色、サイズ、パターン、AIシード）に変換するロジックを`@skycanvas/fireworks-core`などの共有モジュールに実装します。 
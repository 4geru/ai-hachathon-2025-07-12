# Sky Canvas - 技術スタック: Web Audio API

## 1. 概要

Web Audio APIは、Webブラウザ上で複雑な音声処理や合成を可能にするためのJavaScript APIです。音声ファイルの再生だけでなく、リアルタイムでの音声生成、エフェクトの適用、空間オーディオの制御など、高度なオーディオ機能を提供します。本プロジェクト「Sky Canvas」では、ディスプレイアプリにおいて花火のビジュアルと完全に同期した動的な音楽や効果音を生成するために利用されます。

## 2. 採用理由

-   **高機能な音声処理:** リアルタイムでの音声合成、エフェクト適用、ミキシングなど、花火の演出に合わせた多様な音響効果を実現できます。
-   **低遅延:** ブラウザネイティブのAPIであり、音声処理のパイプラインが最適化されているため、ビジュアルとの同期における遅延を最小限に抑えることができます。
-   **Web標準API:** 追加のプラグインや特別なソフトウェアなしで、どのモダンブラウザでも動作します。
-   **表現の豊かさ:** オシレーターノード、ゲインノード、フィルターノードなどを組み合わせて、花火の「Vibe」に応じた無限に近い音色やメロディ、効果音をプログラムで生成できます。

## 3. プロジェクトにおける役割

### 3.1. ディスプレイアプリ

-   **花火発射時の効果音生成:** 花火の打ち上げ音、爆発音、破裂音などをリアルタイムで合成し、再生します。花火の種類や大きさ、特性に応じて音色や音量を変化させます。
-   **動的なBGM生成:** 花火の「Vibe」パラメータ（色、サイズ、パターンなど）に基づいて、Web Audio APIのオシレーターを制御し、花火の演出に合わせた背景音楽を動的に生成します。これにより、一期一会の視覚体験に合わせた一期一会の聴覚体験を提供します。
-   **空間オーディオ:** 打ち上がった花火の位置に応じて音の定位を変化させる（パンニング）ことで、より臨場感のある音響空間を作り出します（例: ドップラー効果、距離減衰）。
-   **サウンドエフェクト:** リバーブ、ディレイ、フィルターなどのエフェクトを動的に適用し、花火の爆発音やBGMに深みを与えます。

## 4. 関連する設計判断

-   **パフォーマンス最適化:** 多数の音声ノードを同時に生成しないように、オーディオコンテキストのリソース管理を適切に行います。必要に応じてオーディオグラフの一部を再利用したり、効率的な音源管理戦略を採用します。
-   **ビジュアルとの同期:** requestAnimationFrameとWeb Audio APIのタイムスタンプ機能を活用し、花火のビジュアルアニメーションと音声再生をミリ秒単位で厳密に同期させます。
-   **ユーザーの操作による再生開始:** 多くのブラウザでは、ユーザーの操作がないと音声の再生が開始できないという制約があります。これに対応するため、初回アクセス時に何らかのユーザー操作（例: 「タップして開始」ボタン）を促すUIを実装します。
-   **AI/生成ロジックとの連携:** `@skycanvas/fireworks-core`で生成された花火のVibeパラメータを基に、Web Audio APIのノードパラメータを動的に調整するロジックを実装します。 
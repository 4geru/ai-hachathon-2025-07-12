# Sky Canvas - 技術スタック: WebGL

## 1. 概要

WebGL (Web Graphics Library) は、Webブラウザ上でインタラクティブな2Dおよび3Dグラフィックスを描画するためのJavaScript APIです。GPUのハードウェアアクセラレーションを直接利用できるため、高性能で視覚的にリッチなアプリケーションを開発できます。本プロジェクト「Sky Canvas」では、ディスプレイアプリにおいて花火の複雑なビジュアル表現を可能にする基盤技術として利用されます。

## 2. 採用理由

-   **高性能なグラフィックス:** GPUを直接操作できるため、大量のパーティクルや複雑なシェーダーを用いた花火のリアルタイム描画において、高いフレームレートと滑らかなアニメーションを実現できます。
-   **カスタムシェーダー:** 頂点シェーダーとフラグメントシェーダーを直接記述することで、花火の光の表現、爆発時の質感、残像効果など、独自の視覚効果を細かく制御できます。
-   **Web標準技術:** プラグイン不要で、主要なモダンWebブラウザに標準で組み込まれているため、広範なデバイスでの動作が期待できます。
-   **Three.jsとの連携:** Three.jsのような高レベルなライブラリと組み合わせて使用することで、WebGLの複雑な低レベルAPIを直接意識することなく、効率的に3Dシーンを構築できます。

## 3. プロジェクトにおける役割

### 3.1. ディスプレイアプリ

-   **花火のレンダリング:** Three.jsを介して、Supabaseから受信したイベントデータに基づく花火の3DモデルやパーティクルをGPU上で描画します。
-   **ビジュアルエフェクトの実装:** カスタムシェーダーを用いて、花火の光彩、色変化、発光、残像、煙、火花の散らばり方など、リアルで幻想的な視覚効果を実装します。
-   **物理シミュレーションの描画:** 花火の打ち上げから爆発、そして消滅までの軌道やパーティクルの動きを、Three.jsによってWebG描画パイプラインに渡し、高速にレンダリングします。

## 4. 関連する設計判断

-   **パフォーマンス最適化:**
    -   **ドローコールの削減:** 可能な限りジオメトリを統合し、インスタンシング描画を活用することで、CPUからGPUへの描画コマンド数を減らします。
    -   **シェーダーの最適化:** 複雑な計算を避け、GPUに最適化されたシェーダーコードを記述することで、描画負荷を軽減します。
    -   **テクスチャ管理:** 効率的なテクスチャアトラスの使用や、必要な解像度でのテクスチャロードを徹底します。
-   **Web Audio APIとの同期:** 視覚効果と聴覚効果を完全に同期させるため、WebGLのレンダリングループとWeb Audio APIのタイムスタンプを綿密に連携させます。
-   **ハードウェア要件:** WebGL 2.0に対応したGPUを搭載したデバイスでの動作を前提としますが、WebGL 1.0へのフォールバックも検討し、より広範な環境での動作を目指します。 
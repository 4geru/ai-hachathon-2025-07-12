# Sky Canvas - 技術スタック: Supabase Client SDK

## 1. 概要

Supabase Client SDKは、WebブラウザやNode.js環境からSupabaseのバックエンドサービス（データベース、認証、ストレージなど）に容易にアクセスするための公式ライブラリです。本プロジェクト「Sky Canvas」では、スマートフォンアプリとディスプレイアプリの両方からSupabaseのリアルタイムデータベースにアクセスし、花火イベントの送受信を行うために利用されます。

## 2. 採用理由

-   **Supabaseとのシームレスな統合:** Supabaseが提供する機能（Realtime、PostgreSQLのCRUD操作、認証など）に特化して設計されており、各機能へのアクセスが非常に簡単です。
-   **リアルタイム機能の容易な利用:** `supabase.from('table').on('*', handler)`のようなシンプルな構文で、データベースの変更をリアルタイムで購読できます。これが「Sky Canvas」の核となる低遅延連携を実現します。
-   **型安全性:** TypeScriptで記述されており、型定義が提供されているため、安全かつ効率的に開発を進めることができます。
-   **開発の迅速性:** バックエンドとの連携に必要なボイラープレートコードを大幅に削減し、フロントエンド開発者がコアロジックに集中できるようにします。

## 3. プロジェクトにおける役割

### 3.1. スマートフォンアプリ

-   **イベントデータの送信:** ユーザーの傾きやジェスチャーから生成された花火イベントデータ（`FireworkEvent`）を、Supabaseの`firework_events`テーブルに`INSERT`します。
-   **Supabaseの初期化:** プロジェクトのAPIキーとURLを使用して、Supabaseクライアントインスタンスを初期化します。

### 3.2. ディスプレイアプリ

-   **リアルタイムイベントの購読:** `firework_events`テーブルの`INSERT`イベントを購読し、スマートフォンアプリから送信された花火イベントデータをリアルタイムで受信します。
-   **Supabaseの初期化:** スマートフォンアプリと同様に、Supabaseクライアントインスタンスを初期化します。

## 4. 関連する設計判断

-   **共通モジュールの利用:** `@skycanvas/supabase-client`という共有パッケージを作成し、Supabaseクライアントの初期化処理、リアルタイム購読の共通ロジック、データ送信ヘルパー関数などを集約します。これにより、コードの重複を防ぎ、一貫性を保ちます。
-   **認証・認可の連携:** 匿名認証を利用する場合でも、Supabase Client SDKを通じて`anon`キーを設定し、必要な`RLS`ポリシーが適用されるようにします。
-   **エラーハンドリング:** ネットワークエラーやAPIエラーが発生した場合に備え、Supabase Client SDKが提供するエラーハンドリング機能を活用し、ユーザーへの適切なフィードバックとログ記録を行います。 
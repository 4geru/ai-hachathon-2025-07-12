# Supabase 実装の次のステップ

このドキュメントでは、`02-requirement.md` および `03-specification.md` に基づき、Supabaseの実装において次に着手すべき項目をまとめます。

## 1. リアルタイムイベントの送受信実装

SupabaseのRealtime機能を利用して、スマートフォンアプリとディスプレイアプリ間で花火イベントをリアルタイムに送受信する機能を実装します。

### 1.1. スマートフォンアプリからのデータ送信

- スマートフォンアプリ（フロントエンド）から、センサーデータ（傾き、ジェスチャー）を `FireworkEvent` フォーマットに整形し、Supabaseの `firework_events` テーブルに挿入する機能を実装します。
- `03-specification.md` の `FireworkEvent` インターフェースに従ってデータを構築し、Supabaseクライアントの `insert` メソッドを使用します。

**関連する要件・仕様:**
- `02-requirement.md` - 「スマートフォンを魔法の杖に」「操作からの反応を0.1秒以内に」「WebSocketによるリアルタイム通信」
- `03-specification.md` - 「スマートフォンアプリ仕様 - データ送信 - Supabaseイベントフォーマット」

### 1.2. ディスプレイアプリでのリアルタイム購読

- ディスプレイアプリ（フロントエンド）から、Supabaseの `firework_events` テーブルに対するリアルタイムサブスクリプションを設定します。
- 新しいイベントが挿入されるたびに、ディスプレイアプリがそれを検知し、花火の演出を開始できるようにします。

**関連する要件・仕様:**
- `02-requirement.md` - 「大画面に花火を打ち上げたい」「操作してから花火が打ち上がるまでのタイムラグをなくしたい」
- `03-specification.md` - 「全体構成 - スマートフォンアプリ --> Supabase Realtime --> ディスプレイアプリ」「データベース仕様 - リアルタイム通知の有効化」

## 2. サーバーサイドロジックの検討（Edge Functions）

将来的には、より複雑な花火の生成ロジックやAI連携のために、Supabase Edge Functionsの利用を検討します。

- `02-requirement.md` に記載されている「AIの力を使って、予想外の美しい花火を生成したい」「花火の形や色をAIで自動生成したい」といった要件は、クライアントサイドだけでなく、サーバーサイドでの処理が適している場合があります。
- 例えば、複雑な物理演算や、AIモデルの呼び出し、または複数のユーザーの操作を統合して一つの花火を生成するようなロジックは、Edge Functionsとして実装することで、パフォーマンスとスケーラビリティを向上させることができます。

**関連する要件・仕様:**
- `02-requirement.md` - 「AIによる生成表現」

これらのステップを順に進めることで、Sky Canvasプロジェクトの主要なリアルタイム機能と、将来的なAI連携基盤を構築できます。

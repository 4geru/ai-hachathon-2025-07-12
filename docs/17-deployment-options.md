# モバイルアプリケーションのデプロイオプション検討

## 📋 プロジェクト概要

### アプリケーション構成
- **フレームワーク**: Next.js 15.3.5
- **言語**: TypeScript
- **UI**: React 19.0.0
- **可視化**: p5.js（花火エフェクト）
- **データベース**: Supabase
- **機能**: 
  - 加速度センサー（DeviceMotion API）
  - リアルタイム花火表示
  - API Routes によるデータ送受信

### 主要ページ
- `/phone`: スマートフォンの加速度センサーでデータ収集
- `/display`: リアルタイム花火表示（P5.js）
- `/api/firework-data`: 加速度データの送受信API

## 🎯 デプロイオプション比較

### 1. Vercel（最推奨）⭐️⭐️⭐️⭐️⭐️

**メリット：**
- Next.js との完璧な親和性
- 無料プランで十分な機能
- 環境変数設定が簡単
- API Routes の完全サポート
- 自動HTTPS（DeviceMotion API に必須）
- 高速なグローバルCDN
- Git連携で自動デプロイ
- サーバーレス環境で高いスケーラビリティ

**デメリット：**
- 特になし（このプロジェクトには最適）

**コスト：**
- 無料プランで十分
- 商用利用時も$20/月から

### 2. Netlify ⭐️⭐️⭐️⭐️

**メリット：**
- 無料プランが充実
- 簡単な設定
- 自動HTTPS対応
- フォーム処理やエッジ機能
- 継続的デプロイ

**デメリット：**
- Next.js のサーバーサイド機能で一部制限あり
- API Routes の制限

**コスト：**
- 無料プランあり
- Pro: $19/月

### 3. Railway ⭐️⭐️⭐️⭐️

**メリット：**
- フルスタックアプリに最適
- 無料プランあり（月500時間）
- 環境変数管理が簡単
- データベース連携が得意
- Docker対応

**デメリット：**
- 設定がやや複雑
- 無料プランの制限

**コスト：**
- 無料プラン：500時間/月
- Pro: $5/月〜

### 4. その他の選択肢

#### AWS Amplify ⭐️⭐️⭐️
- 本格的なクラウドサービス
- 高い可用性とスケーラビリティ
- 設定が複雑

#### Heroku ⭐️⭐️
- 2022年11月から無料プラン廃止
- 最低$5/月から

## 🚀 推奨デプロイ手順（Vercel）

### 1. 事前準備

```bash
# Vercel CLI インストール
npm i -g vercel

# ログイン
vercel login
```

### 2. 環境変数の準備

必要な環境変数：
```
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
```

### 3. デプロイ実行

```bash
# プロジェクトフォルダーに移動
cd mobile

# ビルドテスト
npm run build

# デプロイ
vercel --prod
```

### 4. 環境変数設定

Vercelダッシュボード → Settings → Environment Variables で設定：
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`

### 5. カスタムドメイン（オプション）

デフォルトURL: `your-app-name.vercel.app`

## 📱 デプロイ時の注意点

### 必須要件
1. **HTTPS対応**: DeviceMotion API はHTTPS環境でのみ動作
2. **環境変数**: Supabase接続情報の設定
3. **CORS設定**: 必要に応じてSupabaseのCORS設定

### パフォーマンス最適化
1. **画像最適化**: Next.js Image コンポーネントの活用
2. **バンドルサイズ**: 不要なライブラリの削除
3. **キャッシュ戦略**: 静的リソースのキャッシュ設定

### セキュリティ
1. **環境変数**: 秘密鍵は環境変数で管理
2. **CORS**: 適切なオリジン設定
3. **率制限**: API の適切な制限設定

## 🔧 デプロイ後の確認事項

### 機能テスト
- [ ] Phone ページでの加速度センサー動作
- [ ] Display ページでの花火表示
- [ ] API Routes の動作確認
- [ ] Supabase連携の確認

### パフォーマンス
- [ ] ページ読み込み速度
- [ ] リアルタイム通信の遅延
- [ ] モバイル端末での動作確認

### 監視・ログ
- [ ] エラーログの確認
- [ ] パフォーマンスメトリクス
- [ ] ユーザー行動分析（必要に応じて）

## 💡 結論

**Vercelが最適解**

理由：
1. Next.js アプリケーションとの完璧な親和性
2. 無料プランで十分な機能
3. HTTPS自動対応（DeviceMotion API に必須）
4. 簡単な設定とデプロイ
5. 高いパフォーマンスと可用性

このプロジェクトの要件（リアルタイム通信、センサーAPI、花火表示）を最適にサポートできるプラットフォームです。

## 📅 次のステップ

1. Vercelアカウントの作成
2. 環境変数の設定
3. 初回デプロイの実行
4. 機能テストの実施
5. 必要に応じたパフォーマンス調整 